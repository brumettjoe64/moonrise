<h1>Guest stats</h1>
<table>
  <tr>
    <td>Total Invitees</td>
    <td><%= @guests.count %></td>
  </tr>

  <tr>
    <td> RSVPers </td>
    <td> <%= @invitees.count %> </td>
  </tr>
  <tr>
    <td> Accounts </td>
    <td> <%= @registered.count %> </td>
  </tr>

  <tr>
    <td> Going! </td>
    <td> <%= @gos.count %> </td>
  </tr>
  <tr>
    <td> Not Going :( </td>
    <td> <%= @nos.count %> </td>
  </tr>  
  <tr>
    <td> Maybe.. </td>
    <td> <%= @maybes.count %> </td>
  </tr>  

</table>

<h1>Listing guests</h1>

<table>
  <tr>
    <th></th>
    <th></th>
    <th></th>
    <th>Firstname</th>
    <th>Lastname</th>
    <th>Email</th>
    <th>Key</th>
    <th>Login?</th>
    <th>RSVP</th>
    <th>Info</th>
    <th>Invitee</th>
    <th>Groups</th>

  </tr>

  <% @invitees.each do |invitee| %>
    <% invitee.party.each do |guest| %>
      <tr class="<%= "plusone" if guest.plusone? %>">
        <td><%= link_to('X', guest, method: :delete, confirm: 'Are you sure?') %></td>
        <td><%= link_to('Edit', edit_guest_path(guest)) %></td>
        <td><%= link_to('+', new_guest_path(invitee_id: guest)) if guest.invitee? %></td>
        <td class="<%= "admin" if guest.admin %>"><%= guest.firstname %></td>
        <td class="<%= "admin" if guest.admin %>"><%= guest.lastname %></td>
        <td><%= guest.email %></td>
        <td><%= guest.sitekey %></td>
        <td><%= guest.account_flag %></td>
        <td><%= guest.rsvp %></td>
        <td><%= truncate(guest.rsvp_info, length: 10) %></td>
        <td><%= guest.invitee.initials %></td>
        <td><%= guest.groups.map{|x| x.name}.join(", ")%></td>
      </tr>
    <% end %>
  <% end %>
</table>

<br>

<%= link_to 'New Invitee', new_guest_path %>
